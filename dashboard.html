<!DOCTYPE html>
<html lang="en" ng-app="evoltActiveApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dashboard - Evolt Active</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
</head>
<body ng-controller="DashboardController">
    <header>
        <div class="logo">Fit & Thrive</div>
        <nav>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#progress">My Progress</a></li>
                <li><a href="#mealplan">Meal Plan</a></li>
                <li>Hi, {{ savedName }}!</li>
                <li><a href="#" ng-click="logout()">Logout</a></li>
            </ul>
        </nav>
    </header>

    <section id="products" class="products-section" ng-if="isAuthenticated">
        <h2>Manage Products</h2>
        <form ng-submit="addProduct()">
            <input type="text" ng-model="newProduct.name" placeholder="Product Name" required />
            <input type="text" ng-model="newProduct.category" placeholder="Category" required />
            <input type="number" ng-model="newProduct.price" placeholder="Price" required />
            <button type="submit">Add Product</button>
        </form>
    
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="product in products">
                    <td>{{ product.name }}</td>
                    <td>{{ product.category }}</td>
                    <td>{{ product.price }}</td>
                    <td>
                        <button ng-click="editProduct(product)">Edit</button>
                        <button ng-click="deleteProduct(product.id)">Delete</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </section>
    <script>
        // AngularJS Application
        var app = angular.module('evoltActiveApp', []);
        // Dashboard Controller
        app.controller('DashboardController', function($scope, $window, $http) {
            $scope.isAuthenticated = false;

            $scope.getName = function() {
                $scope.savedName = $window.localStorage.getItem('name');
            };
            
            $scope.getName();

             // Dummy data for Daily Progress
             $scope.dailyProgress = [
                { date: '2024-11-23', calories: 300, steps: 5000, activeHours: 3 },
                { date: '2024-11-24', calories: 450, steps: 7500, activeHours: 4 },
                { date: '2024-11-25', calories: 500, steps: 9000, activeHours: 5 }
            ];
            // Dummy data for Weekly Goals
            $scope.weeklyGoals = [
                { day: 'Monday', steps: 5000, calories: 200 },
                { day: 'Tuesday', steps: 7000, calories: 300 },
                { day: 'Wednesday', steps: 6000, calories: 250 }
            ];

            // Check if token exists
            const token = localStorage.getItem('token');
            if (token) {
                // Verify token with backend
                $http.get('http://localhost:8000/api/protected', {
                    headers: { 'Authorization': 'Bearer ' + token }
                }).then(function(response) {
                    $scope.isAuthenticated = true;
                    console.log('Authenticated:', response.data);
                }).catch(function(error) {
                    $scope.isAuthenticated = false;
                    if (error.status === 401) {
                        alert('Session expired. Please log in again.');
                        localStorage.removeItem('token');
                        window.location.href = 'login.html';
                    }
                });
            } else {
                window.location.href = 'login.html';
            }

            // Logout Function
            $scope.logout = function() {
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            };
        });
    </script>
</body>
</html>
